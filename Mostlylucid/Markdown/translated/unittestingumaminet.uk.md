# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–¥—É–ª—ñ–≤ Umami.Net - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ UmamiClient

# –í—Å—Ç—É–ø

–¢–µ–ø–µ—Ä —É –º–µ–Ω–µ —î [–ü–∞–∫—É–Ω–æ–∫ amamami.Net](https://www.nuget.org/packages/Umami.Net/) –Ø, –∑–≤–∏—á–∞–π–Ω–æ, —Ö–æ—á—É –∑–∞–ø–µ–≤–Ω–∏—Ç–∏, —â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î, —è–∫ –æ—á—ñ–∫—É–≤–∞–ª–æ—Å—è. –©–æ–± –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ, —Ç–æ –Ω–∞–π–∫—Ä–∞—â–µ –±—É–ª–æ –± —Ç—Ä–æ—Ö–∏ –¥–æ–∫–ª–∞–¥–Ω–æ –≤–∏–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤—Å—ñ —Å–ø–æ—Å–æ–±–∏ –π –∫–ª–∞—Å–∏. –°–∞–º–µ —Ç—É—Ç –∑'—è–≤–ª—è—î—Ç—å—Å—è —Ç–µ—Å—Ç –Ω–∞ –æ–¥–∏–Ω–∏—Ü—ñ.
–ó–∞—É–≤–∞–∂–µ–Ω–Ω—è: —Ü–µ –Ω–µ "–¥–æ—Å–∫–æ–Ω–∞–ª–∏–π –ø—ñ–¥—Ö—ñ–¥" —Ç–∏–ø—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —Ü–µ –ø—Ä–æ—Å—Ç–æ —Ç–µ, —è–∫ —è —Ü–µ –∑—Ä–æ–±–∏–≤ –Ω–∞ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç. –í –¥—ñ–π—Å–Ω–æ—Å—Ç—ñ –º–µ–Ω—ñ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≥–ª—É–∑—É–≤–∞—Ç–∏ `IHttpMessageHandler` –¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∞—Å—Ç–∏ –Ω–∞ DelagingMessageHandler, —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –∑–≤–∏—á–∞–π–Ω–∏–º HttpClient. –Ø –ª–∏—à–µ —Ö–æ—Ç—ñ–≤ –ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ —Ü–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–æ–∫–∞.

[TOC]

<!--category-- xUnit, Umami -->
<datetime class="hidden">2024- 09- 01T17: 22</datetime>

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–¥–∏–Ω–∏—Ü—å

–û–¥–∏–Ω–∏—á–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–æ—Å—É—î—Ç—å—Å—è –ø—Ä–æ—Ü–µ—Å—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –æ–∫—Ä–µ–º–∏—Ö –æ–¥–∏–Ω–∏—Ü—å –∫–æ–¥—É, —â–æ–± –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤–æ–Ω–∏ –ø—Ä–∞—Ü—é—é—Ç—å, —è–∫ –æ—á—ñ–∫—É–≤–∞–ª–æ—Å—è. –¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏, –Ω–∞–ø–∏—Å–∞–≤—à–∏ —Ç–µ—Å—Ç–∏, —â–æ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –º–µ—Ç–æ–¥–∏ —ñ –∫–ª–∞—Å–∏ —É –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π —Å–ø–æ—Å—ñ–±, –∞ –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –≤–∏—Ö—ñ–¥, —è–∫ —ñ –æ—á—ñ–∫—É–≤–∞–ª–æ—Å—è.

–î–ª—è –ø–∞–∫—É–Ω–∫–∞ –Ω–∞ –∑—Ä–∞–∑–æ–∫ Umami.Net —Ü–µ —Ç–∞–∫ —Å–∫–ª–∞–¥–Ω–æ, —è–∫ —Ç–µ, —â–æ –æ–±–∏–¥–≤–∞ –Ω–∞–∑–∏–≤–∞—é—Ç—å –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–º –∫–ª—ñ—î–Ω—Ç–æ–º —á–µ—Ä–µ–∑ `HttpClient` —ñ –º–∞—î `IHostedService` –≤–æ–Ω–∞ —Ä–æ–±–∏—Ç—å –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –ø–æ–¥—ñ–π —è–∫–æ–º–æ–≥–∞ –±–µ–∑–ø–µ—Ä–µ—à–∫–æ–¥–Ω–æ.

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ UmamiClient

–û—Å–Ω–æ–≤–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è `HttpClient` –±–∞–∑–æ–≤–∞–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —É–Ω–∏–∫–∞—î –≤–∏–∫–ª–∏–∫—É " HttpClient." –¶–µ —Ä–æ–±–∏—Ç—å—Å—è —à–ª—è—Ö–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è a `HttpClient` —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î a `HttpMessageHandler` —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–æ–º—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å. –¶–µ —Ä–æ–±–∏—Ç—å—Å—è —à–ª—è—Ö–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è a `HttpClient` –∑ a `HttpMessageHandler` —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–æ–º—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å. –£ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É —è –ø—Ä–æ—Å—Ç–æ –≤—ñ–¥–ª—É—é –≤—Ö—ñ–¥–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—é, —â–æ —Ü–µ –Ω–µ –±—É–ª–æ —Å–ø–æ—Ç–≤–æ—Ä–µ–Ω–æ `UmamiClient`.

```csharp
    public static HttpMessageHandler Create()
    {
        var mockHandler = new Mock<HttpMessageHandler>();

        mockHandler.Protected()
            .Setup<Task<HttpResponseMessage>>(
                "SendAsync",
                ItExpr.Is<HttpRequestMessage>(x => x.RequestUri.ToString().Contains("api/send")),
                ItExpr.IsAny<CancellationToken>())
            .ReturnsAsync((HttpRequestMessage request, CancellationToken cancellationToken) =>
            {
                // Read the request content
                var requestBody = request.Content != null
                    ? request.Content.ReadAsStringAsync(cancellationToken).Result
                    : null;

                // Create a response that echoes the request body
                var responseContent = requestBody != null
                    ? requestBody
                    : "No request body";


                // Return the response
                return new HttpResponseMessage(HttpStatusCode.OK)
                {
                    Content = new StringContent(responseContent, Encoding.UTF8, "application/json")
                };
            });

        return mockHandler.Object;
    }
```

–Ø–∫ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ, —Ü–µ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è `Mock<HttpMessageHandler>` –ü–æ—Ç—ñ–º —è –≤—Ö–æ–¥–∂—É –≤ `UmamiClient`.
–£ —Ü—å–æ–º—É –∫–æ–¥—ñ —è –ø—ñ–¥–∫–ª—é—á–∞—é —Ü–µ –¥–æ –Ω–∞—à–æ—ó `IServiceCollection` –º–µ—Ç–æ–¥ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è. –¶–µ –¥–æ–¥–∞—î –≤—Å—ñ —Å–ª—É–∂–±–∏, –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è `UmamiClient` –≤–∫–ª—é—á–∞—é—á–∏ –Ω–∞—à –Ω–æ–≤–∏–π `HttpMessageHandler` –∞ –ø–æ—Ç—ñ–º –ø–æ–≤–µ—Ä—Ç–∞—î `IServiceCollection` –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —Ç–µ—Å—Ç–∞—Ö.

```csharp
    public static IServiceCollection SetupServiceCollection(string webSiteId = Consts.WebSiteId,
        string umamiPath = Consts.UmamiPath, HttpMessageHandler? handler = null)
    {
        var services = new ServiceCollection();
        var umamiClientSettings = new UmamiClientSettings
        {
            WebsiteId = webSiteId,
            UmamiPath = umamiPath
        };
        services.AddSingleton(umamiClientSettings);
        services.AddScoped<PayloadService>();
        services.AddLogging(x => x.AddConsole());
        // Mocking HttpMessageHandler with Moq
        var mockHandler = handler ?? EchoMockHandler.Create();
        services.AddHttpClient<UmamiClient>((serviceProvider, client) =>
        {
            var umamiSettings = serviceProvider.GetRequiredService<UmamiClientSettings>();
            client.BaseAddress = new Uri(umamiSettings.UmamiPath);
        }).ConfigurePrimaryHttpMessageHandler(() => mockHandler);
        return services;
    }
```

–©–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü–µ —ñ –≤–≤–µ—Å—Ç–∏ –π–æ–≥–æ –≤ `UmamiClient` –ü–æ—Ç—ñ–º —è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é —Ü—ñ –ø–æ—Å–ª—É–≥–∏ –≤ `UmamiClient` –ó–∞—Ä—è–¥–∂–∞–π.

```csharp
    public static UmamiClient GetUmamiClient(IServiceCollection? serviceCollection = null,
        HttpContextAccessor? contextAccessor = null)
    {
        serviceCollection ??= SetupServiceCollection();
        SetupUmamiClient(serviceCollection, contextAccessor);
        if (serviceCollection == null) throw new NullReferenceException(nameof(serviceCollection));
        var serviceProvider = serviceCollection.BuildServiceProvider();
        return serviceProvider.GetRequiredService<UmamiClient>();
    }
```

–í–∏ –ø–æ–±–∞—á–∏—Ç–µ, —â–æ —è –º–∞—é –Ω–∏–∑–∫—É –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —è–∫—ñ –¥–∞—é—Ç—å –º–µ–Ω—ñ –∑–º–æ–≥—É –≤–≤–µ—Å—Ç–∏ —Ä—ñ–∑–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ —Ç–µ—Å—Ç—ñ–≤.

### –¢–µ—Å—Ç–∏

–¢–µ–ø–µ—Ä —è –º–∞—é –≤—Å—ñ —Ü—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ –º—ñ—Å—Ü—ñ, —è –º–æ–∂—É –ø–æ—á–∞—Ç–∏ –ø–∏—Å–∞—Ç–∏ —Ç–µ—Å—Ç–∏ –¥–ª—è `UmamiClient` –º–µ—Ç–æ–¥–∏.

#### –ù–∞–¥—ñ—Å–ª–∞—Ç–∏

–í—Å–µ —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –Ω–∞—à—ñ —Ç–µ—Å—Ç–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ—Å–∏—Ç—å –ø—Ä–æ—Å—Ç–∏–º–∏

```csharp
public class UmamiClient_SendTests
{
    [Fact]
    public async Task Send_Wrong_Type()
    {
        var umamiClient = SetupExtensions.GetUmamiClient();
        await Assert.ThrowsAsync<ArgumentException>(async () => await umamiClient.Send(type: "boop"));
    }

    [Fact]
    public async Task Send_Empty_Success()
    {
        var umamiClient = SetupExtensions.GetUmamiClient();
        var response = await umamiClient.Send();
        Assert.Equal(HttpStatusCode.OK, response.StatusCode);
    }
}
```

–¢—É—Ç –≤–∏ –±–∞—á–∏—Ç–µ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Ç–µ—Å—Ç, –ø—Ä–æ—Å—Ç–æ –≥–∞—Ä–∞–Ω—Ç—É—é—á–∏, —â–æ `UmamiClient` –º–æ–∂–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å; –≤–∞–∂–ª–∏–≤–æ, —â–æ –º–∏ —Ç–∞–∫–æ–∂ —Ç–µ—Å—Ç—É—î–º–æ –¥–ª—è –≤–∏–Ω—è—Ç–∫—É –≤–∏–ø–∞–¥–æ–∫, –¥–µ `type` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –¶–µ —á–∞—Å—Ç–æ –Ω–µ –∑–≤–µ—Ä—Ç–∞—î —É–≤–∞–≥–∏ –Ω–∞ —á–∞—Å—Ç–∏–Ω—É —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏, —â–æ –∫–æ–¥ –∑–∞–∑–Ω–∞—î –Ω–µ–≤–¥–∞—á—ñ, —è–∫ —ñ –æ—á—ñ–∫—É–≤–∞–ª–æ—Å—è.

#### –ü–µ—Ä–µ–≥–ª—è–¥ —Å—Ç–æ—Ä—ñ–Ω–æ–∫

–©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –Ω–∞—à —Å–ø–æ—Å—ñ–± –ø–µ—Ä–µ–≥–ª—è–¥—É —Å—Ç–æ—Ä—ñ–Ω–æ–∫, –º–∏ –º–æ–∂–µ–º–æ –∑—Ä–æ–±–∏—Ç–∏ —â–æ—Å—å –ø–æ–¥—ñ–±–Ω–µ. –£ –∫–æ–¥—ñ –Ω–∏–∂—á–µ —è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é –º—ñ–π `EchoHttpHandler` —â–æ–± –≤—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –≤—ñ–¥—ñ—Å–ª–∞–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å —ñ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤–æ–Ω–∞ –≤—ñ–¥—Å–∏–ª–∞—î –Ω–∞–∑–∞–¥ —Ç–µ, —á–æ–≥–æ —è –æ—á—ñ–∫—É—é.

```csharp
    [Fact]
    public async Task TrackPageView_WithNoUrl()
    {
        var defaultUrl = "/testpath";
        var contextAccessor = SetupExtensions.SetupHttpContextAccessor(path: "/testpath");
        var umamiClient = SetupExtensions.GetUmamiClient(contextAccessor: contextAccessor);
        var response = await umamiClient.TrackPageView();

        var content = await response.Content.ReadFromJsonAsync<EchoedRequest>();
        Assert.NotNull(response);
        Assert.NotNull(content);
        Assert.Equal(content.Payload.Url, defaultUrl);
        Assert.Equal(HttpStatusCode.OK, response.StatusCode);
    }
```

### HttpContextAccessor

This using the `HttpContextAccessor` –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —à–ª—è—Ö –¥–æ `/testpath` –∞ –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —â–æ `UmamiClient` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–¥—Å–∏–ª–∞—î —Ü–µ.

```csharp
    public static HttpContextAccessor SetupHttpContextAccessor(string host = Consts.Host,
        string path = Consts.Path, string ip = Consts.Ip, string userAgent = Consts.UserAgent,
        string referer = Consts.Referer)
    {
        HttpContext httpContext = new DefaultHttpContext();
        httpContext.Request.Host = new HostString(host);
        httpContext.Request.Path = new PathString(path);
        httpContext.Connection.RemoteIpAddress = IPAddress.Parse(ip);
        httpContext.Request.Headers.UserAgent = userAgent;
        httpContext.Request.Headers.Referer = referer;

        var context = new HttpContextAccessor { HttpContext = httpContext };
        return context;
    }

```

–¶–µ –≤–∞–∂–ª–∏–≤–æ –¥–ª—è –∫–æ–¥—É –Ω–∞—à–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞ –£–º–∞–º—ñ, –æ—Å–∫—ñ–ª—å–∫–∏ –±—ñ–ª—å—à—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö, –Ω–∞–¥—ñ—Å–ª–∞–Ω–∏—Ö –∑ –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É, —Ñ–∞–∫—Ç–∏—á–Ω–æ, –¥–∏–Ω–∞–º—ñ—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑ `HttpContext` –æ–±'—î–∫—Ç. –û—Ç–∂–µ, –º–∏ –Ω–µ –º–æ–∂–µ–º–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω—ñ—á–æ–≥–æ –≤ `await umamiClient.TrackPageView();` –≤–∏–∫–ª–∏–∫, —ñ –≤—ñ–Ω –≤—Å–µ —â–µ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏–º–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è–º Url –∑ `HttpContext`.

–Ø–∫ –º–∏ –ø–æ–±–∞—á–∏–º–æ –ø—ñ–∑–Ω—ñ—à–µ, —Ü–µ —Ç–∞–∫–æ–∂ –≤–∞–∂–ª–∏–≤–æ, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç–∞–∫—ñ —Ä–µ—á—ñ, —è–∫ `UserAgent` —ñ `IPAddress` –æ—Å–∫—ñ–ª—å–∫–∏ —Ü—ñ —Å–µ—Ä–≤–µ—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è —Å—Ç–µ–∂–µ–Ω–Ω—è –∑–∞ –¥–∞–Ω–∏–º–∏ —ñ –ø–µ—Ä–µ–≥–ª—è–¥–∞–º–∏ " –¥–æ—Ä—ñ–∂–∫–∏ " –±–µ–∑ –∫—É–∫.

–î–ª—è —Ç–æ–≥–æ, —â–æ–± –º–∞—Ç–∏ —Ü–µ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–µ –º–∏ –≤–∏–∑–Ω–∞—á–∞—î–º–æ –∫—É–ø—É –∫–æ–Ω—Å—Ç –≤ `Consts` –ö–ª–∞—Å. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–∏ –º–æ–∂–µ–º–æ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ—Ç–∏ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —Ç–∞ –∑–∞–ø–∏—Ç—ñ–≤.

```csharp
public class Consts
{
    public const string UmamiPath = "https://example.com";
    public const string WebSiteId = "B41A9964-FD33-4108-B6EC-9A6B68150763";
    public const string Host = "example.com";
    public const string Path = "/example";
    public const string Ip = "127.0.0.1";
    public const string UserAgent = "Test User Agent";
    public const string Referer = "Test Referer";
    public const string DefaultUrl = "/testpath";
    public const string DefaultTitle = "Example Page";
    public const string DefaultName = "RSS";
    public const string DefaultType = "event";

    public const string Email = "test@test.com";

    public const string UserId = "11224456";
    
    public const string UserName = "Test User";
    
    public const string SessionId = "B41A9964-FD33-4108-B6EC-9A6B68150763";
}
```

## –ü–æ–¥–∞–ª—å—à–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–≠—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ –Ω–∞—à–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –£–º–∞–º–∏. –ú—ã –≤—Å–µ –µ—â–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `IHostedService` —ñ —Ç–µ—Å—Ç –ø—Ä–æ—Ç–∏ —Ñ–∞–∫—Ç–∏—á–Ω–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö –£–º–∞–º—ñ (—è–∫–∏–π –Ω—ñ–¥–µ –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç—É—î—Ç—å—Å—è, –∞–ª–µ –º—ñ—Å—Ç–∏—Ç—å –∫–ª—é—á JWT –∑ –¥–µ—è–∫–∏–º–∏ –∫–æ—Ä–∏—Å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏).

```json
{
  "alg": "HS256",
  "typ": "JWT"
}{
  "id": "b9836672-feee-55c5-985a-a5a23d4a23ad",
  "websiteId": "32c2aa31-b1ac-44c0-b8f3-ff1f50403bee",
  "hostname": "example.com",
  "browser": "chrome",
  "os": "Windows 10",
  "device": "desktop",
  "screen": "1920x1080",
  "language": "en-US",
  "country": "GB",
  "subdivision1": null,
  "subdivision2": null,
  "city": null,
  "createdAt": "2024-09-01T09:26:14.418Z",
  "visitId": "e7a6542f-671a-5573-ab32-45244474da47",
  "iat": 1725182817
}2|Y*: ÔøΩ(N%-ﬁò^1>@V
```

–û—Ç–∂–µ, –º–∏ —Ö–æ—á–µ–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü–µ, —ñ–º—ñ—Ç—É–≤–∞—Ç–∏ –∫–ª—é—á —ñ, –º–æ–∂–ª–∏–≤–æ, –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –¥–∞–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ –≤—ñ–∑–∏—Ç—É (—Ç–∞–∫ —è–∫ –≤–∏ –ø–∞–º'—è—Ç–∞—î—Ç–µ, —Ü–µ –∑—Ä–æ–±–ª–µ–Ω–æ –∑ a `uuid(websiteId,ipaddress, useragent)`).

# –í–∫–ª—é—á–µ–Ω–Ω—è

–¶–µ —Ç—ñ–ª—å–∫–∏ –ø–æ—á–∞—Ç–æ–∫ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø–∞–∫—É–Ω–∫–∞ Umami.Net, —î —â–µ –±–∞–≥–∞—Ç–æ —Ä–æ–±–æ—Ç–∏, –∞–ª–µ —Ü–µ —Ö–æ—Ä–æ—à–∏–π –ø–æ—á–∞—Ç–æ–∫. –Ø –¥–æ–¥–∞–º –±—ñ–ª—å—à–µ —Ç–µ—Å—Ç—ñ–≤ —ñ, –±–µ–∑ —Å—É–º–Ω—ñ–≤—É, –ø–æ–∫—Ä–∞—â—É–≤–∞—Ç–∏–º—É —ó—Ö.