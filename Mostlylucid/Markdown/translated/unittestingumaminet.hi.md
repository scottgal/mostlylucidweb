# рдЗрдХрд╛рдИ рдЬрд╛рдВрдЪ рдЙрдордореА. net - рдЯреЗрд╕реНрдЯ рдЙрдордореАрдо

# рдкрд░рд┐рдЪрдп

рдЕрдм рдореЗрд░реЗ рдкрд╛рд╕ рд╣реИ [рдЙрдордореА рдкреИрдХреЗрдЬ](https://www.nuget.org/packages/Umami.Net/) рд╡рд╣рд╛рдБ рдмрд╛рд╣рд░ рдореИрдВ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдпрд╣ рд╕рднреА рдХреА рдЙрдореНрдореАрдж рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд╛рд╣рддреЗ рд╣реИрдВ. рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИ, рд╕рднреА рддрд░реАрдХрд╝реЛрдВ рдФрд░ рд╡рд░реНрдЧреЛрдВ рдХреЛ рд╕реАрдорд┐рдд рд░реВрдк рд╕реЗ рдЬрд╛рдБрдЪ рдХрд░рдирд╛ ред рдпрд╣ рдЗрдХрд╛рдИ рдЬрд╛рдБрдЪ рдореЗрдВ рдЖрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╣реИ.
рдиреЛрдЯ: рдпрд╣ рдПрдХ 'рд╕рд┐рджреНрдз рдкреНрд░рд╡реЗрд╢ рддрд░рд╣ рдХреЗ рдкреЛрд╕реНрдЯ рдирд╣реАрдВ рд╣реИ, рдпрд╣ рд╣реИ рдХрд┐ рдХреИрд╕реЗ рдореИрдВ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдпрд╣ рдХрд┐рдпрд╛ рд╣реИ. рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдореИрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдирдХрд▓реА рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИ `IHttpMessageHandler` рдпрд╣рд╛рдБ рдПрдХ рдЖрдк рдПрдХ рд╡рд┐рдирд╛рд╢рдХрд╛рд░реА рд╕рдВрджреЗрд╢рд░ рдкрд░ рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╣ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп Diald рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдореИрдВ рд╕рд┐рд░реНрдл рдЖрдк рдЗрд╕реЗ рдПрдХ рдирдХрд▓реА рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рджрд┐рдЦрд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛.

[рд╡рд┐рд╖рдп

<!--category-- xUnit, Umami -->
<datetime class="hidden">2024- 09- 0117: 22</datetime>

# рдЗрдХрд╛рдИ рдЬрд╛рдБрдЪ

рдЗрдХрд╛рдИ рдЬрд╛рдБрдЪ рдХреЛрдб рдХреЗ рд╡реНрдпрдХреНрддрд┐ рдХреЛ рдЬрд╛рдБрдЪрдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рддрд╛ рд╣реИ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╡реЗ рд╡рд╛рдВрдЫрд┐рдд рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ. рдЗрд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЙрди рддрд░реАрдХрд╝реЛрдВ рдФрд░ рд╡рд░реНрдЧреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЖрдЙрдЯрдкреБрдЯ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХреА рдЬрд╛рддреА рд╣реИ ред

рдЙрдордореА рдХреА рддрд░рд╣ рдПрдХ рдкреИрдХреЗрдЬ рдХреЗ рд▓рд┐рдП рдпрд╣ рдмрд╣реБрдд рд╣реА рдореБрд╢реНрдХрд┐рд▓ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рджреЛрдиреЛрдВ рдПрдХ рд░рд┐рдореЛрдЯ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ `HttpClient` рдФрд░ рдпреЗ рдХрд┐ рдЙрд╕реА рдкрд░ (рдХрдпрд╛рдордд рдореЗрдВ) рджреЛрдмрд╛рд░рд╛ рдЙрдард╛рдирд╛ рд▓рд╛рдЬрд╝рд┐рдо рд╣реИ `IHostedService` рдпрд╣ рдирдП рдХрд╛рд░реНрдпрдХреНрд░рдо рдбрд╛рдЯрд╛ рдХреЛ рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЙрддрдирд╛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ ред

## рдЙрдордореА рдХреБрд▓ рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ

рдкрд░реАрдХреНрд╖рд╛ рдХрд╛ рдореБрдЦреНрдп рднрд╛рдЧ `HttpClient` рдЖрдзрд╛рд░рд┐рдд рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╡рд╛рд╕реНрддрд╡рд┐рдХ'рдХрд╣реАрдВ' рдХреЙрд▓ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ. рдЗрд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ `HttpClient` рдЬреЛ рдПрдХ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ `HttpMessageHandler` рдпрд╣ рдПрдХ рдЬреНрдЮрд╛рдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдмрддрд╛рддрд╛ рд╣реИ. рдЗрд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ `HttpClient` рдПрдХ рдХреЗ рд╕рд╛рде `HttpMessageHandler` рдХрд┐ рдПрдХ рдЬреНрдЮрд╛рдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдмрддрд╛рддрд╛ рд╣реИ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдореИрдВ рд╕рд┐рд░реНрдл рдЗрдирдкреБрдЯ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдкрд╕ рджреЗрддрд╛ рд╣реВрдБ рдФрд░ рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реВрдБ рдХрд┐ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ `UmamiClient`.

```csharp
    public static HttpMessageHandler Create()
    {
        var mockHandler = new Mock<HttpMessageHandler>();

        mockHandler.Protected()
            .Setup<Task<HttpResponseMessage>>(
                "SendAsync",
                ItExpr.Is<HttpRequestMessage>(x => x.RequestUri.ToString().Contains("api/send")),
                ItExpr.IsAny<CancellationToken>())
            .ReturnsAsync((HttpRequestMessage request, CancellationToken cancellationToken) =>
            {
                // Read the request content
                var requestBody = request.Content != null
                    ? request.Content.ReadAsStringAsync(cancellationToken).Result
                    : null;

                // Create a response that echoes the request body
                var responseContent = requestBody != null
                    ? requestBody
                    : "No request body";


                // Return the response
                return new HttpResponseMessage(HttpStatusCode.OK)
                {
                    Content = new StringContent(responseContent, Encoding.UTF8, "application/json")
                };
            });

        return mockHandler.Object;
    }
```

рдЖрдк рдЗрд╕ рд╕реЗрдЯ рдПрдХ рджреЗрдЦ рдЬрд╛рдПрдЧрд╛ рдХреЗ рд░реВрдк рдореЗрдВ `Mock<HttpMessageHandler>` рдлрд┐рд░ рдореИрдВ рдЕрдВрджрд░ рдЬрд╛рддрд╛ рд╣реВрдБ `UmamiClient`.
рдЗрд╕ рдХреЛрдб рдореЗрдВ рдореИрдВ рдЗрд╕реЗ рд╣рдорд╛рд░реЗ рдореЗрдВ рд╣реБрдХ рдХрд░реЗрдВ `IServiceCollection` рд╡рд┐рдзрд┐ рд╕реЗрдЯрдЕрдк рдХрд░реЗрдВ. рдпрд╣ рд╕рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИ `UmamiClient` рд╣рдорд╛рд░реЗ рдирдП рдХреЛ рднреА рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ `HttpMessageHandler` рдлрд┐рд░ (рдЙрд╕рдХрд╛) рдПрдХ рдЕрдиреНрджрд╛рдЬрд╝рд╛ рдореБрдХрд╝рд░реНрд░рд░ рдХрд┐рдпрд╛ `IServiceCollection` рдкрд░реАрдХреНрд╖рдг рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП.

```csharp
    public static IServiceCollection SetupServiceCollection(string webSiteId = Consts.WebSiteId,
        string umamiPath = Consts.UmamiPath, HttpMessageHandler? handler = null)
    {
        var services = new ServiceCollection();
        var umamiClientSettings = new UmamiClientSettings
        {
            WebsiteId = webSiteId,
            UmamiPath = umamiPath
        };
        services.AddSingleton(umamiClientSettings);
        services.AddScoped<PayloadService>();
        services.AddLogging(x => x.AddConsole());
        // Mocking HttpMessageHandler with Moq
        var mockHandler = handler ?? EchoMockHandler.Create();
        services.AddHttpClient<UmamiClient>((serviceProvider, client) =>
        {
            var umamiSettings = serviceProvider.GetRequiredService<UmamiClientSettings>();
            client.BaseAddress = new Uri(umamiSettings.UmamiPath);
        }).ConfigurePrimaryHttpMessageHandler(() => mockHandler);
        return services;
    }
```

рдЗрд╕реЗ рдкреНрд░рдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдЙрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `UmamiClient` рдореИрдВ рддреЛ рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ `UmamiClient` рд╕реЗрдЯрдЕрдк.

```csharp
    public static UmamiClient GetUmamiClient(IServiceCollection? serviceCollection = null,
        HttpContextAccessor? contextAccessor = null)
    {
        serviceCollection ??= SetupServiceCollection();
        SetupUmamiClient(serviceCollection, contextAccessor);
        if (serviceCollection == null) throw new NullReferenceException(nameof(serviceCollection));
        var serviceProvider = serviceCollection.BuildServiceProvider();
        return serviceProvider.GetRequiredService<UmamiClient>();
    }
```

рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдореИрдВ рд╡реИрдХрд▓реНрдкрд┐рдХ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдпрд╣рд╛рдБ рдореБрдЭреЗ рд╡рд┐рднрд┐рдиреНрди рдкрд░реАрдХреНрд╖рд╛ рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рдмрд╛рд╣рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реВрдБред

### рдкрд░реАрдХреНрд╖рдг

рддреЛ рдЕрдм рдореИрдВ рдЬрдЧрд╣ рдореЗрдВ рдЗрд╕ рд╕рднреА рд╕реЗрдЯрдЕрдк рд╣реИ...... рдореИрдВ рдЕрдм рдХреЗ рд▓рд┐рдП рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╛рдБрдЪ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ `UmamiClient` рддрд░реАрдХреЗ ред

#### рднреЗрдЬреЗрдВ

рдХреНрдпрд╛ рдЗрд╕ рд╕реЗрдЯрдЕрдк рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдорд╛рд░реА рдкрд░реАрдХреНрд╖рд╛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдмрд╣реБрдд рд╕рд░рд▓ рд╣реЛ рд╕рдХрддреА рд╣реИ

```csharp
public class UmamiClient_SendTests
{
    [Fact]
    public async Task Send_Wrong_Type()
    {
        var umamiClient = SetupExtensions.GetUmamiClient();
        await Assert.ThrowsAsync<ArgumentException>(async () => await umamiClient.Send(type: "boop"));
    }

    [Fact]
    public async Task Send_Empty_Success()
    {
        var umamiClient = SetupExtensions.GetUmamiClient();
        var response = await umamiClient.Send();
        Assert.Equal(HttpStatusCode.OK, response.StatusCode);
    }
}
```

рдпрд╣рд╛рдБ рдЖрдк рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рдЬрд╛рдВрдЪ рдорд╛рдорд▓реЗ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рдмрд╕ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ `UmamiClient` рдПрдХ рд╕рдВрджреЗрд╢ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ; рдорд╣рддреНрд╡рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рд╣рдо рдХрд┐рд╕реА рдЕрдкрд╡рд╛рдж рдХреЗ рд▓рд┐рдП рднреА рдкрд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдБ рдХреЛрдИ рдЕрдкрд╡рд╛рдж рд╣реЛ `type` рдЧрд▓рдд рд╣реИ. рдпрд╣ рдЕрдХрд╕рд░ рдЬрд╛рдБрдЪ рдХреЗ рдПрдХ рднрд╛рдЧ рдХреЛ рдирдЬрд╝рд░рдЕрдВрджрд╛рдЬрд╝ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рдирд┐рд╢реНтАНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рд░реВрдк рд╕реЗ рдЕрд╕рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ ред

#### рдкреГрд╖реНрда рджреГрд╢реНрдп

рдЕрдкрдиреЗ рдкреЗрдЬ рджреГрд╢реНрдп рд╡рд┐рдзрд┐ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рднреА рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ ред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХреЛрдб рдореЗрдВ рдореИрдВ рдЕрдкрдирд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ `EchoHttpHandler` рдмрд╕ рд╡рд╛рдкрд╕ рднреЗрдЬрдиреЗ рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдореНрдмрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдпрд╣ рдореИрдВ рдХреНрдпрд╛ рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реВрдБ.

```csharp
    [Fact]
    public async Task TrackPageView_WithNoUrl()
    {
        var defaultUrl = "/testpath";
        var contextAccessor = SetupExtensions.SetupHttpContextAccessor(path: "/testpath");
        var umamiClient = SetupExtensions.GetUmamiClient(contextAccessor: contextAccessor);
        var response = await umamiClient.TrackPageView();

        var content = await response.Content.ReadFromJsonAsync<EchoedRequest>();
        Assert.NotNull(response);
        Assert.NotNull(content);
        Assert.Equal(content.Payload.Url, defaultUrl);
        Assert.Equal(HttpStatusCode.OK, response.StatusCode);
    }
```

### 2880 рд╕рдВрджрд░реНрднрдХрд░реНрддрд╛

рдпрд╣ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ `HttpContextAccessor` рдкрде рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `/testpath` рдлрд┐рд░ рдЬрд╛рдБрдЪ рдХрд░рддрд╛ рд╣реИ рдЕрд▓рдЧ-рдЕрд▓рдЧ, `UmamiClient` рдпрд╣ рдЙрдЪрд┐рдд рд░реВрдк рд╕реЗ рднреЗрдЬ рджрд┐рдпрд╛ рдЧрдпрд╛.

```csharp
    public static HttpContextAccessor SetupHttpContextAccessor(string host = Consts.Host,
        string path = Consts.Path, string ip = Consts.Ip, string userAgent = Consts.UserAgent,
        string referer = Consts.Referer)
    {
        HttpContext httpContext = new DefaultHttpContext();
        httpContext.Request.Host = new HostString(host);
        httpContext.Request.Path = new PathString(path);
        httpContext.Connection.RemoteIpAddress = IPAddress.Parse(ip);
        httpContext.Request.Headers.UserAgent = userAgent;
        httpContext.Request.Headers.Referer = referer;

        var context = new HttpContextAccessor { HttpContext = httpContext };
        return context;
    }

```

рдпрд╣ рд╣рдорд╛рд░реЗ рдЙрдордореА рдХреНрд▓рд╛рдПрдВрдЯ рдХреЛрдб рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдирд┐рд╡реЗрджрди рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдбрд╛рдЯрд╛ рдХреЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкреНрд░рднрд╛рд╡рд╢рд╛рд▓реА рд░реВрдк рд╕реЗ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ `HttpContext` рд╡рд╕реНрддреБ. рддреЛ рд╣рдо рдПрдХ рдореЗрдВ рдХреБрдЫ рднреА рдирд╣реАрдВ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ `await umamiClient.TrackPageView();` рдХреЙрд▓ рдФрд░ рдпрд╣ рдЕрднреА рднреА рдпреВрдЖрд░рдПрд▓ рдХреЛ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕рд╣реА рдбрд╛рдЯрд╛ рднреЗрдЬ рджреЗрдЧрд╛ `HttpContext`.

рдЬреИрд╕реЗ рд╣рдо рдмрд╛рдж рдореЗрдВ рджреЗрдЦреЗрдВрдЧреЗ рдпрд╣ рднреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдбрд░ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдРрд╕реЗ рднреЗрдЬрдирд╛ `UserAgent` рдФрд░ `IPAddress` рдЬрдм рдпреЗ рдЙрдордореА рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдпреЛрдЧ рдореЗрдВ рд▓рд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рддреЛ рдбреЗрдЯрд╛ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдФрд░ 'рдЯреНрд░реИрдХ' рдЙрдкрдпреЛрдХреНрддрд╛ рджреГрд╢реНрдпреЛрдВ рдХреЛ рдмрд┐рдирд╛ рдХреБрдХреАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рд░рдЦрддрд╛ рд╣реИ.

рдЗрд╕ рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП...... рд╣рдо рдореЗрдВ рдХрдиреЗрдХреНрд╢рди рдХреЗ рдПрдХ рдЧреБрдЪреНрдЫрд╛ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рджреЗрдВ `Consts` рд╡рд░реНрдЧ. рддреЛ рд╣рдо рдЕрдЯрдХрд▓реЗрдВ рд▓рдЧрд╛рдиреЗ рдФрд░ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЬрд╛рдБрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ.

```csharp
public class Consts
{
    public const string UmamiPath = "https://example.com";
    public const string WebSiteId = "B41A9964-FD33-4108-B6EC-9A6B68150763";
    public const string Host = "example.com";
    public const string Path = "/example";
    public const string Ip = "127.0.0.1";
    public const string UserAgent = "Test User Agent";
    public const string Referer = "Test Referer";
    public const string DefaultUrl = "/testpath";
    public const string DefaultTitle = "Example Page";
    public const string DefaultName = "RSS";
    public const string DefaultType = "event";

    public const string Email = "test@test.com";

    public const string UserId = "11224456";
    
    public const string UserName = "Test User";
    
    public const string SessionId = "B41A9964-FD33-4108-B6EC-9A6B68150763";
}
```

## рдЖрдЧреЗ рдХреА рдЬрд╛рдБрдЪ

рдпрд╣ рд╕рд┐рд░реНрдл рдЙрдордореА рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдкрд░реАрдХреНрд╖рдг рд░рдгрдиреАрддрд┐ рдХреА рд╢реБрд░реБрдЖрдд рд╣реИ, рд╣рдо рдЕрднреА рднреА рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ `IHostedService` рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдбрд╛рдЯрд╛ рдЙрдордореА рдХреЗ рдЦрд┐рд▓рд╛рдл рдкрд░реАрдХреНрд╖рд╛ (рдЬреЛ рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рд╣реИ) рдкрд░ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧреА рдбрд╛рдЯрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рдЬреЗ рдбрдмреНрд▓реНрдпреВрдЖрдИрдЯреА рдЯреЛрдХрди рд╣реИ.)

```json
{
  "alg": "HS256",
  "typ": "JWT"
}{
  "id": "b9836672-feee-55c5-985a-a5a23d4a23ad",
  "websiteId": "32c2aa31-b1ac-44c0-b8f3-ff1f50403bee",
  "hostname": "example.com",
  "browser": "chrome",
  "os": "Windows 10",
  "device": "desktop",
  "screen": "1920x1080",
  "language": "en-US",
  "country": "GB",
  "subdivision1": null,
  "subdivision2": null,
  "city": null,
  "createdAt": "2024-09-01T09:26:14.418Z",
  "visitId": "e7a6542f-671a-5573-ab32-45244474da47",
  "iat": 1725182817
}2|Y*: я┐╜(N%-▐Ш^1>@V
```

рддреЛ рд╣рдо рдЙрд╕ рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рд╕рдВрдХреЗрдд рдХрд╛ рд╕рд┐рдореБрд▓реЗрдЯ рдХрд░реЗрдВ рдФрд░ рд╕рдВрднрд╡рддрдГ рдкреНрд░рддреНрдпреЗрдХ рднреЗрдВрдЯ рдкрд░ рдбреЗрдЯрд╛ рд▓реМрдЯрд╛ рджреЗрдВ (рдЬреИрд╕реЗ рдЖрдк рдЗрд╕реЗ рдпрд╛рдж рдХрд░реЗрдВрдЧреЗ) `uuid(websiteId,ipaddress, useragent)`).

# рдСрдиреНрдЯрд┐рдпрдо

рдпрд╣ рд╕рд┐рд░реНрдл рдЙрдордореА рдкреИрдХреЗрдЬ рдкрд░реАрдХреНрд╖рдг рдХреА рд╢реБрд░реБрдЖрдд рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдЕрдЪреНрдЫреА рд╢реБрд░реБрдЖрдд рд╣реИ. рдореИрдВ рдЗрди рд▓реЛрдЧреЛрдВ рдХреЛ рд╕реБрдзрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдкрд░реАрдХреНрд╖рдг рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛.